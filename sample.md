BigQueryでデータを作成し、それをGoogleスプレッドシート（Connected Sheets）で表示するまでの手順を、ステップバイステップで解説します。

これは**「BigQueryにデータ基盤を作り、ビジネスサイドがスプレッドシートから参照する」**という、実務でも非常によく使われる構成の基礎となります。

---

### 前提条件

* Google Cloud Platform (GCP) のアカウントを持っていること。
* GCPのプロジェクトが作成されていること（まだの場合は作成してください）。

---

### ステップ 1: BigQuery コンソールを開く

1. Google Cloud Console ( [console.cloud.google.com](https://console.cloud.google.com/) ) にアクセスします。
2. 左側のナビゲーションメニューから **「BigQuery」** を選択します。
* ※見つからない場合は、上部の検索バーに「BigQuery」と入力してください。



---

### ステップ 2: データセットとテーブル（ダミーデータ）の作成

UI（ボタン操作）で作ることもできますが、**SQLを実行する方が圧倒的に早くて確実**です。以下の手順で、データセットの作成からデータの流し込みまでを一括で行います。

1. BigQueryの画面中央にある **「クエリを新規作成」**（または `+` ボタン）をクリックします。
2. 以下のSQLコードをコピーして、エディタに貼り付けます。
* **重要:** 1行目の `あなたのプロジェクトID` の部分を、実際のプロジェクトID（画面左上のロゴの横に表示されています）に書き換えてください。



```sql
-- 1. データセット（フォルダのようなもの）を作成
CREATE SCHEMA IF NOT EXISTS `あなたのプロジェクトID.demo_dataset`;

-- 2. テーブルを作成し、同時にダミーデータを挿入
CREATE OR REPLACE TABLE `あなたのプロジェクトID.demo_dataset.sales_dummy` AS
SELECT
  101 AS order_id, 'ノートPC' AS product, 120000 AS price, DATE('2023-10-01') AS sale_date, '東京本店' AS store
UNION ALL
SELECT 102, 'マウス', 3000, DATE('2023-10-02'), '大阪支店'
UNION ALL
SELECT 103, 'キーボード', 8000, DATE('2023-10-02'), '東京本店'
UNION ALL
SELECT 104, 'モニター', 25000, DATE('2023-10-03'), '名古屋支店'
UNION ALL
SELECT 105, 'USBハブ', 1500, DATE('2023-10-04'), '福岡支店';

```

3. **「実行」** ボタンをクリックします。
4. 左側の「エクスプローラ」パネルに `demo_dataset` が現れ、その中に `sales_dummy` テーブルができていることを確認してください。

---

### ステップ 3: Google スプレッドシートと連携する

ここには2つの方法がありますが、**データが更新されたらスプレッドシート側も更新できる「コネクテッドシート」機能**を使います。

1. ブラウザで新しいタブを開き、Google スプレッドシートを新規作成します（URL欄に `sheets.new` と打つと早いです）。
2. メニューバーから **「データ」** > **「データコネクタ」** > **「BigQuery に接続」** をクリックします。
3. **プロジェクトを選択:** 先ほど使用したプロジェクトを選択します。
4. **データセットを選択:** `demo_dataset` を選択します。
5. **テーブルを選択:** `sales_dummy` を選択し、**「接続」** をクリックします。

> **Note:** 「BigQueryに接続」メニューが表示されない場合、アカウントがEnterpriseプラン（Google Workspace）でない可能性があります。その場合は、下記「補足：別の方法」を参照してください。

---

### ステップ 4: データを表示・確認する

接続が完了すると、新しいシート「sales_dummy」が作成されますが、まだデータの中身は見えません（集計用の準備画面になります）。

**生データをそのまま表示させたい場合:**

1. 追加されたシート上の表のようなエリアにある **「抽出」** タブ（またはボタン）をクリックします。
2. 右側にエディタが開くので、**「新しい抽出を作成」** をクリックします。
3. **列:** 「すべての列を追加」や必要なカラム（`product`, `price`など）を選びます。
4. **行の制限:** デフォルトのままでOKです。
5. **「適用」** をクリックします。

これで、BigQueryに入れたダミーデータがスプレッドシート上に表示されました！

---

### 補足：もう一つの簡単な方法（単なるエクスポート）

もしステップ3の「データコネクタ」機能が使えない場合や、1回限りのデータコピーで良い場合は、以下の手順が最も簡単です。

1. BigQueryのコンソールに戻ります。
2. `SELECT * FROM demo_dataset.sales_dummy` を実行して結果を表示させます。
3. 結果パネルの右上にある **「結果を保存」** > **「Google スプレッドシート」** を選択します。
4. 数秒後に「スプレッドシートを開く」というリンクが出るので、それをクリックします。

---

### まとめ

これで以下のパイプラインが完成しました。

1. **BigQuery:** データの保管場所（`sales_dummy`テーブル）
2. **Google Sheets:** データの閲覧・分析インターフェース

**コネクテッドシート（ステップ3の方法）の利点**は、BigQuery側でSQLを使ってデータを `INSERT` して増やした場合、スプレッドシート側で「更新」ボタンを押すだけで最新データが反映される点です。

**次はこれを試してみませんか？**
スプレッドシート上で「ピボットテーブル」や「グラフ」を作成し、BigQueryのデータを可視化するダッシュボードを作ってみましょうか？手順を案内できます。

BigQuery上のデータを書き換えるには、`UPDATE` というSQL文を使います。

以下の手順で、`order_id` が **104** のデータを更新し、それをスプレッドシートに反映させてみましょう。

### 手順 1: BigQueryで更新用SQLを実行する

1. BigQueryコンソールの「クエリを新規作成」を開きます。
2. 以下のSQLを貼り付けます（`あなたのプロジェクトID` は書き換えてください）。

```sql
UPDATE `あなたのプロジェクトID.demo_dataset.sales_dummy`
SET product = 'マルチディスプレイモニター'
WHERE order_id = 104;

```

3. **「実行」** ボタンを押します。
* *「このステートメントにより X 行が変更されました」* と表示されれば成功です。



---

### 手順 2: スプレッドシート側で変更を確認する（重要）

BigQueryのデータは更新されましたが、**スプレッドシート側は自動でリアルタイムには変わりません**（定期更新の設定をしていない限り）。手動で最新情報を取得する必要があります。

1. 先ほど作成したスプレッドシート（Connected Sheets）を開きます。
2. 画面の下の方にあるステータスバー、または表の近くにある **「更新」**（または「プレビューを更新」）ボタンをクリックします。
* ※もし「抽出」タブを使っている場合は、抽出の設定画面にある「更新」ボタンを押してください。


3. `order_id: 104` の `product` が **「マルチディスプレイモニター」** に変わったことを確認してください。

---

### 解説

* **UPDATE文:** 既存のデータを変更する命令です。
* **WHERE句:** `WHERE order_id = 104` を書き忘れると、**テーブル内のすべての商品の名前が変わってしまう**ので、非常に重要です。

**次はこれをやってみませんか？**
現在データは5件だけですが、SQLを使って**「一気に100件分のダミーデータを追加」**してみますか？データ量が増えた時のスプレッドシートの動きを確認できます。