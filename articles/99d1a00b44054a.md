---
title: "Supabaseのことはじめ"
emoji: "⚡"
type: "tech"
topics: ["supabase", "postgresql", "api", "beginner"]
published: true
---

## はじめに

最近よく聞く Supabase。

「Firebaseの代替」「PostgreSQLが使えるBaaS」
そんな説明は見かけるものの、  
正直なところ 何がそんなにいいのかはピンときていませんでした。

APIは結局自分で作るんでしょ？  
DBがPostgreSQLなだけでは？

この記事は、Supabaseを初めて触ったときに「え、もうAPI使えるの？」と驚いた体験を、Supabaseことはじめとしての覚書です。

## プロジェクトを作る

[Supabase公式サイト](https://supabase.com/)でアカウントを作成し、「New project」をクリックします。

入力するのは次の3つだけ。

1. Organization
2. プロジェクト名
3. DBパスワード

数分待つと、PostgreSQLデータベースが立ち上がります。

この時点で、
- サーバー構築なし
- Dockerなし
- マイグレーション設定なし

ブラウザだけです。

## テーブルを作る

ダッシュボードの「Table Editor」から  
新しいテーブルを作ります。

今回はシンプルに `tasks` テーブル。

![](/images/99d1a00b44054a/001.png)

### カラム設定

![](/images/99d1a00b44054a/002.png)

| カラム名 | 型 | 説明 |
| --- | --- | --- |
| id | int8 | 主キー |
| title | text | タスク名 |
| is_complete | boolean | 完了フラグ |
| created_at | timestamptz | 作成日時 |

ここで RLS（Row Level Security）をON にしておきます。

正直、この時点では「なんかセキュリティっぽいやつ」くらいの理解でした。

## データを1件入れる

Table Editorから、テスト用に1件だけデータを追加します。

![](/images/99d1a00b44054a/004.png)

ここまでは、「普通にDBを触っている」感覚です。

## 何もしてないのにAPIがある

ダッシュボードの「Settings → API」を見ると、

- Project URL
- anon public key

が用意されています。

試しに `curl` で叩いてみます。

```bash
curl "https://[your-project-id].supabase.co/rest/v1/tasks" \
  -H "apikey: [your-anon-key]" \
  -H "Authorization: Bearer [your-anon-key]"
````

返ってきたのは、

```json
[]
```

……空。

でもエラーではありません。

## RLSが原因だった

理由はシンプルで、RLSがONなのに、アクセス許可を書いていないから。

Supabaseでは、

> 許可されていないデータは、存在しないものとして扱う

という挙動になります。

SQL Editorで、学習用に次のポリシーを追加します。

```sql
CREATE POLICY "Tasks are viewable by everyone"
ON tasks
FOR SELECT
USING (true);
```

もう一度APIを叩くと……

![](/images/99d1a00b44054a/009.png)

ちゃんとデータが返ってきました。

## 「APIを作った」感覚がない

ここで少し不思議な感覚になります。

* APIルーティングを書いていない
* Controllerもない
* ORMもない

でも、APIとしては普通に使える。

自分がやったことは、

1. テーブルを作った
2. データを入れた
3. アクセスしていい条件を書いた

それだけです。

## まとめ：Supabaseを触って最初に感じたこと

Supabaseを初めて触って感じたのは、

> 「APIは作るもの」だと思い込んでいた

ということでした。

Supabaseでは、

* テーブルを作ると
* その構造に沿ったAPIが
* 最初から存在している

そして、
アクセスできるかどうかはRLSで決まる。

この体験をすると、

* APIとは何か
* セキュリティはどこで担保すべきか
* 設計とは何を決めることなのか

その考え方が、少し変わります。

もし

* API実装がしんどい
* 個人開発でバックエンドが重い
* DB設計からちゃんと考えたい

と思っているなら、一度Supabaseを「何も考えずに触ってみる」のはおすすめです。