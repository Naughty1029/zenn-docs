---
title: "BigQueryとConnected Sheetsで作る、ビジネスサイドに優しいデータ基盤入門"
emoji: "📊"
type: "tech"
topics: ["bigquery", "googlespreadsheet", "gcp", "dataanalysis", "dataengineering"]
published: true
---

## はじめに

データ分析の環境を整備しようと思ったとき、こんな壁にぶつかったことはありませんか。

「データはBigQueryに入れたけど、SQLを書けない人はどうやって見るの？」
「毎回CSVをエクスポートしてスプレッドシートに貼り付けるのは手間がかかりすぎる...」

私自身、データ基盤を構築する際に、ビジネスサイドから「普段使っているスプレッドシートで見たい」というニーズをよく耳にしていました。そこで出会ったのが、BigQueryとGoogleスプレッドシートの **Connected Sheets（コネクテッドシート）** 機能です。

この記事では、BigQueryにデータを作成し、それをGoogleスプレッドシートで表示するまでの手順を、ゼロから丁寧に解説します。「BigQueryにデータ基盤を作り、ビジネスサイドがスプレッドシートから参照する」という、実務でも非常によく使われる構成の基礎を学べる内容になっています。

## BigQueryとConnected Sheetsの基本

まず、これから扱う技術について簡単に説明します。

**BigQuery**は、Googleが提供するフルマネージドのデータウェアハウスです。大量のデータを高速に分析できる仕組みで、SQLを使ってデータの保存や集計ができます。データ基盤の中核として多くの企業で採用されています。

**Connected Sheets**は、Googleスプレッドシートから直接BigQueryのデータにアクセスできる機能です。従来のように「BigQueryでクエリを実行 → CSVダウンロード → スプレッドシートにインポート」という手間が不要になり、スプレッドシート上で「更新」ボタンを押すだけで最新データが反映されます。

### なぜこの組み合わせが有効なのか

従来の方法では、データを見るたびに手動でエクスポートとインポートを繰り返す必要がありました。また、データが更新されるたびに同じ作業が発生し、非効率的でした。

Connected Sheetsを使えば、次のようなメリットがあります。

- **データの鮮度を保てる** BigQuery側でデータが更新されても、スプレッドシート側で「更新」ボタンを押すだけで最新データが取得できます
- **SQLが書けなくても大丈夫** スプレッドシートの操作に慣れている人なら、誰でも使えます
- **既存のワークフローに統合しやすい** 多くのビジネスパーソンが使い慣れたスプレッドシートをそのまま活用できます

それでは、実際にこの環境を構築してみましょう。

## 全体の流れ

今回実現する構成は以下のようになります。

```
BigQuery（データの保管・管理）
    ↓
Connected Sheets（データの閲覧・分析）
```

具体的には、次のステップで進めていきます。

1. BigQueryでデータセットとテーブルを作成し、サンプルデータを投入
2. Googleスプレッドシートを開き、Connected Sheets機能でBigQueryに接続
3. データの表示を確認
4. BigQuery側でデータを更新し、スプレッドシート側に反映

では、実際に手を動かしていきましょう。

## 前提条件

この記事を進めるには、以下の準備が必要です。

- Google Cloud Platform（GCP）のアカウントを持っていること
- GCPのプロジェクトが作成されていること

:::message
まだプロジェクトを作成していない場合は、[Google Cloud Console](https://console.cloud.google.com/)からプロジェクトを作成してください。
:::

## ステップ1: BigQueryコンソールを開く

まず、BigQueryにアクセスします。

1. [Google Cloud Console](https://console.cloud.google.com/)にアクセスします
2. 左側のナビゲーションメニューから「BigQuery」を選択します

もしメニューに見つからない場合は、上部の検索バーに「BigQuery」と入力すると素早くアクセスできます。

## ステップ2: データセットとテーブルの作成

ここでは、SQLを使ってデータセット（データを整理するフォルダのようなもの）とテーブルを一括で作成します。UIのボタン操作でも作成できますが、SQLを実行する方が圧倒的に早くて確実です。

### データセットとサンプルデータの準備

BigQueryの画面中央にある「クエリを新規作成」（または `+` ボタン）をクリックし、以下のSQLコードを貼り付けます。

:::message alert
1行目の `あなたのプロジェクトID` の部分は、実際のプロジェクトIDに書き換えてください。プロジェクトIDは画面左上のロゴの横に表示されています。
:::

```sql
-- 1. データセット（フォルダのようなもの）を作成
CREATE SCHEMA IF NOT EXISTS `あなたのプロジェクトID.demo_dataset`;

-- 2. テーブルを作成し、同時にダミーデータを挿入
CREATE OR REPLACE TABLE `あなたのプロジェクトID.demo_dataset.sales_dummy` AS
SELECT
  101 AS order_id, 'ノートPC' AS product, 120000 AS price, DATE('2023-10-01') AS sale_date, '東京本店' AS store
UNION ALL
SELECT 102, 'マウス', 3000, DATE('2023-10-02'), '大阪支店'
UNION ALL
SELECT 103, 'キーボード', 8000, DATE('2023-10-02'), '東京本店'
UNION ALL
SELECT 104, 'モニター', 25000, DATE('2023-10-03'), '名古屋支店'
UNION ALL
SELECT 105, 'USBハブ', 1500, DATE('2023-10-04'), '福岡支店';
```

「実行」ボタンをクリックすると、データセットとテーブルが作成されます。

![BigQueryでのSQL実行画面](/images/af994fb8e11648/af994fb8e11648-001.png)

左側の「エクスプローラ」パネルに `demo_dataset` が現れ、その中に `sales_dummy` テーブルができていることを確認してください。

![作成されたテーブルのスキーマ](/images/af994fb8e11648/af994fb8e11648-002.png)

:::message
このSQLでは、サンプルとして5件の売上データを作成しています。実際の運用では、ここに本番データが入ることになります。
:::

これでBigQuery側のデータ準備が完了しました。次は、このデータをスプレッドシートから参照できるようにしていきます。

## ステップ3: スプレッドシートとBigQueryを連携する

ここからは、Googleスプレッドシートを使ってBigQueryのデータにアクセスします。Connected Sheets機能を使うことで、データが更新されたらスプレッドシート側も更新できるようになります。

### Connected Sheetsの設定

1. ブラウザで新しいタブを開き、Googleスプレッドシートを新規作成します

ブラウザのURL欄に `sheets.new` と打つと、すぐに新しいスプレッドシートが作成されます。

2. メニューバーから「データ」→「データコネクタ」→「BigQueryに接続」をクリックします

![スプレッドシートのデータコネクタメニュー](/images/af994fb8e11648/af994fb8e11648-004.png)

3. 以下の順で選択していきます
   - **プロジェクトを選択** 先ほど使用したプロジェクトを選択
   - **データセットを選択** `demo_dataset` を選択
   - **テーブルを選択** `sales_dummy` を選択

4. 「接続」をクリックします

:::message
「BigQueryに接続」メニューが表示されない場合、アカウントがGoogle WorkspaceのEnterpriseプランでない可能性があります。その場合は、記事後半の「補足：別の方法」を参照してください。
:::

## ステップ4: データを表示する

接続が完了すると、新しいシート「sales_dummy」が自動的に作成されます。ただし、この段階ではまだデータの中身は見えません（集計用の準備画面になっています）。

生データをそのまま表示させるには、以下の手順を実行します。

1. 追加されたシート上の表のようなエリアにある「抽出」タブ（またはボタン）をクリックします
2. 右側にエディタが開くので、「新しい抽出を作成」をクリックします
3. 列の設定で「すべての列を追加」を選択するか、必要なカラム（`product`、`price`など）を個別に選びます
4. 行の制限はデフォルトのままでOKです
5. 「適用」をクリックします

これで、BigQueryに入れたサンプルデータがスプレッドシート上に表示されました。

![Connected Sheetsでのデータ表示](/images/af994fb8e11648/af994fb8e11648-005.png)

:::message
ここで表示されているデータは、BigQueryから取得したものです。スプレッドシートに直接入力したデータではないため、スプレッドシート上で編集することはできません。
:::

では次に、BigQuery側でデータを更新し、それをスプレッドシート側に反映させる方法を見ていきましょう。

## データの更新と同期

Connected Sheetsの大きなメリットの一つは、BigQuery側でデータを更新したときに、スプレッドシート側で簡単に最新データを取得できる点です。実際に試してみましょう。

### BigQueryでデータを更新する

BigQuery上のデータを書き換えるには、`UPDATE`というSQL文を使います。今回は、`order_id`が**104**のデータを更新してみます。

1. BigQueryコンソールの「クエリを新規作成」を開きます
2. 以下のSQLを貼り付けます（`あなたのプロジェクトID`は実際のIDに書き換えてください）

```sql
UPDATE `あなたのプロジェクトID.demo_dataset.sales_dummy`
SET product = 'マルチディスプレイモニター'
WHERE order_id = 104;
```

3. 「実行」ボタンを押します

「このステートメントにより1行が変更されました」と表示されれば成功です。

:::message alert
`WHERE`句を書き忘れると、テーブル内のすべての商品名が変わってしまいます。データを更新する際は、必ず更新対象を明確に指定しましょう。
:::

### スプレッドシート側で変更を確認する

BigQueryのデータは更新されましたが、スプレッドシート側は自動でリアルタイムには変わりません（定期更新の設定をしていない限り）。手動で最新情報を取得する必要があります。

1. 先ほど作成したスプレッドシート（Connected Sheets）を開きます
2. 画面の下の方にあるステータスバー、または表の近くにある「更新」（または「プレビューを更新」）ボタンをクリックします

「抽出」タブを使っている場合は、抽出の設定画面にある「更新」ボタンを押してください。

3. `order_id: 104`の`product`が「マルチディスプレイモニター」に変わったことを確認してください

![更新ボタンでデータを同期](/images/af994fb8e11648/af994fb8e11648-006.png)

このように、BigQuery側でデータを更新し、スプレッドシート側で「更新」ボタンを押すだけで、最新データが反映されます。

## 補足：別の方法（単なるエクスポート）

もしConnected Sheets機能が使えない場合や、1回限りのデータコピーで良い場合は、以下の手順が最も簡単です。

1. BigQueryのコンソールに戻ります
2. `SELECT * FROM demo_dataset.sales_dummy`を実行して結果を表示させます
3. 結果パネルの右上にある「結果を保存」→「Googleスプレッドシート」を選択します
4. 数秒後に「スプレッドシートを開く」というリンクが出るので、それをクリックします

ただし、この方法ではBigQuery側でデータが更新されても、スプレッドシート側に自動で反映されません。あくまで1回限りのデータコピーとして使いましょう。

## まとめ

この記事では、BigQueryとGoogleスプレッドシートのConnected Sheets機能を使って、データ基盤の基礎を構築する方法を解説しました。

重要なポイントをおさらいします。

- **BigQuery**はデータの保管・管理に適したデータウェアハウス
- **Connected Sheets**を使えば、SQLを書けない人でもスプレッドシートからBigQueryのデータにアクセスできる
- BigQuery側でデータを更新しても、スプレッドシート側で「更新」ボタンを押すだけで最新データが取得できる
- データの更新には`UPDATE`文を使い、`WHERE`句で対象を明確に指定することが重要

この構成を実務で使う場合、次のステップとしてピボットテーブルやグラフを作成し、BigQueryのデータを可視化するダッシュボードを作ることもできます。また、現在はサンプルデータが5件だけですが、実際の運用では数百万件のデータを扱うこともあります。

BigQueryとConnected Sheetsの組み合わせは、データエンジニアリングとビジネス分析を橋渡しする強力なツールです。ぜひ実務で活用してみてください。
