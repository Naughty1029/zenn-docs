---
title: "DBの根元から Part04 - クラウドネイティブDBと次世代技術の潮流"
emoji: "🚀"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["database", "aurora", "newsql", "serverless", "timeseries"]
published: false
---

## シリーズナビゲーション

この記事は「DBの根元から」シリーズの第4回（最終回）です。

**シリーズ全体**
- [Part01：パンチカードからSQLへの道のり](https://zenn.dev/articles/71a5cc7e5d4f20)
- [Part02：商用DBMSとオープンソース革命](https://zenn.dev/articles/0ecdd417518745)
- [Part03：クラウド時代の幕開けとマネージドDB革命](https://zenn.dev/articles/d068f6c3cf7f06)
- **Part04：クラウドネイティブ時代の到来**（この記事）

**前の記事**  
[Part03：クラウド時代の幕開けとマネージドDB革命](https://zenn.dev/articles/d068f6c3cf7f06)では、AWSの登場がもたらしたクラウド革命と、RDSなどのマネージドサービスがデータベース運用をいかに変革したかを解説しました。

---

# DBの根元から Part04

## はじめに

前回のPart03では、AWSクラウドの登場とマネージドデータベースサービスが業界に与えた革命的な変化を見てきました。RDSによってデータベース運用の負荷が劇的に軽減され、エンジニアがより創造的な作業に集中できる環境が整いました。

しかし、クラウド時代が成熟するにつれて、従来のデータベース管理システム（DBMS）の根本的な制約が明らかになってきました。既存のMySQLやPostgreSQLをクラウド上で便利に使えるようにしただけでは、クラウドの真の潜在能力を活かしきれなかったのです。

今回のPart04では、クラウドのために完全に設計し直されたAmazon Auroraの登場と、それに続く次世代データベース技術の潮流を解説します。サーバーレスデータベース、NewSQL、時系列データベースなど、2010年代から2020年代にかけて生まれた革新的な技術が、いかにしてデータベースの概念を拡張し続けているかを詳しく見ていきます。

## 第9章：Aurora - クラウドネイティブDBMSの誕生（2014年）

### RDSが抱えていた根本的な限界

RDSは確かに素晴らしいサービスでしたが、ある重要な問題を抱えていました。既存のDBMS（MySQLやPostgreSQL）をクラウド上で便利に使えるようにしただけで、**DBMS自体の根本的な制限は残っていた**のです。

従来のDBMSの基本構造を振り返ってみましょう。アプリケーションがDBサーバーと通信し、DBサーバー内でMySQL（DBMS）が動作してデータベース管理を行い、MySQLは同じサーバー内のローカルディスク（HDD/SSD）にデータをファイルとして保存します。この「アプリケーション → MySQL → ローカルディスク」という流れでSQL文が処理され、結果は逆順でアプリケーションに返される仕組みです。

この伝統的な構造には、クラウド時代には致命的な3つの問題点がありました。

### 従来のRDBMSが抱える3つの制約

**問題1：ストレージの物理的限界**

当時のRDSでは、最大ストレージ容量が16TBという制限がありました。これは物理的な単一サーバーのディスク容量の限界によるもので、YouTube、Facebook級の大規模データを扱うサービスには明らかに不十分でした。データ量の急激な増加に対して、根本的な解決策が必要だったのです。

**問題2：レプリケーションの非効率性**

従来の構造では、マスターDBとレプリカDBがそれぞれ独立したストレージを持っていました。そのため、マスターは各レプリカにデータページ全体を送信し、各レプリカが自分のストレージに書き込む必要がありました。この仕組みには、マスターの負荷が高い、レプリケーション遅延（ラグ）が発生する、フェイルオーバーに数分かかる、ネットワーク帯域を大量消費するといった問題がありました。

**問題3：I/Oボトルネックによる性能劣化**

MySQLでは、データを「ページ」という16KBの単位で管理しています。そのため、たった1文字を変更する場合でも、`UPDATE users SET name = '太郎' WHERE id = 1`といった小さな変更であっても、該当データが含まれる16KB分のページ全体をディスクに書き込む必要がありました。大量のアクセスが発生する環境では、このディスクへの書き込み処理（I/O）が追いつかず、深刻なボトルネックとなっていたのです。

### Amazon Aurora誕生の革命的コンセプト

これらの問題を解決するため、AWSは2014年11月、まったく新しいアプローチを採用しました。「**クラウド専用に、ゼロからDBMSを設計し直したらどうだろう？**」という発想から生まれたのがAmazon Auroraです。

Auroraのコンセプトは「クラウドのために生まれたデータベース」でした。従来のDBMSは物理サーバーで動くことを前提に設計されていましたが、クラウド環境には全く異なる最適設計があるはずだという考えに基づいて開発されました。

### 革命的アイデア1：ストレージとコンピュートの分離

Auroraの最も革新的なアイデアは、「ストレージとコンピュートを完全に分離する」ことでした。

**従来のMySQL RDS vs Aurora の構造比較**

```
従来のRDS MySQL:
┌─────────────────────────────┐
│        単一サーバー          │
│  ┌─────────────────────┐    │
│  │   MySQL (処理)      │    │
│  └─────────────────────┘    │
│  ┌─────────────────────┐    │
│  │ ローカルディスク     │    │  ← 問題：16TB制限
│  │    (保存)          │    │
│  └─────────────────────┘    │
└─────────────────────────────┘

Aurora:
┌─────────────────┐    ┌────────────────────┐
│ Aurora Compute  │    │ Aurora Storage     │
│   (処理のみ)    │────│   (保存のみ)       │  ← 利点：128TB対応
│                 │    │  分散・自動拡張    │
└─────────────────┘    └────────────────────┘
```

**身近な例で理解する「分離」のメリット**

従来のRDS（一体型）= **個人のパソコン**
- CPU（処理）とハードディスク（保存）が一体
- ディスクが足りなくなったら物理的に交換が必要
- 故障すると両方とも使えない

Aurora（分離型）= **Google Drive + ブラウザ**
- ブラウザ（処理）とGoogle Drive（保存）が分離
- 保存容量は自動で拡張される
- パソコンが壊れても、別のパソコンで同じデータにアクセス可能

この分離により、複数の革命的な利点が生まれました。

**自動スケーリングの実現**では、従来のRDSがディスク不足時に手動追加とダウンタイムを必要とし、最大16TBの制限があったのに対し、Auroraは10GB単位で自動拡張し、ダウンタイムなしで最大128TB（現在）まで拡張可能になりました。

**レプリケーションの劇的な高速化**も実現しました。

```
従来のRDS（各サーバーが独立ストレージ）:
[マスター] ──16KB全体──→ [レプリカ1のストレージ]
    │      ──16KB全体──→ [レプリカ2のストレージ]
    │      ──16KB全体──→ [レプリカ3のストレージ]
    └────── [マスターのストレージ]

Aurora（共通ストレージ）:
[マスター] ──ログのみ──→ [共通 Aurora Storage]
[レプリカ1] ←──────────── [同じストレージを参照]
[レプリカ2] ←──────────── [同じストレージを参照]
[レプリカ3] ←──────────── [同じストレージを参照]
```

### 革命的アイデア2：ログベースのストレージシステム

Auroraの2つ目の革新は、「ログベース」のアプローチでした。

従来のMySQLでは、データ更新時にデータページ全体（16KB）を読み込み、1箇所だけ変更して、データページ全体（16KB）を書き込むという非効率なプロセスを行っていました。

Auroraでは、データ更新時に変更ログ（差分）だけを書き込む方式に変更しました。これによりI/Oが劇的に削減されます。

具体的な比較をすると、1000件の更新処理において、従来のMySQLでは16MB（16KB × 1000）の書き込みが必要でしたが、Auroraでは約300KB（300B × 1000）で済むようになりました。同じI/O回数でも、ネットワーク転送量が大幅に削減され、処理時間も大幅に短縮されたのです。

### 革命的アイデア3：クォーラムベースの耐障害性

Auroraの3つ目の革新は、「クォーラムベース」の仕組みです。

Auroraでは、3つのアベイラビリティゾーン（AZ）に6つのデータコピーを配置します。例えば、AZ-1（東京-1）にコピー1とコピー2、AZ-2（東京-2）にコピー3とコピー4、AZ-3（東京-3）にコピー5とコピー6を配置します。

クォーラムベースでは「過半数が成功すればOK」という考え方を採用しています。書き込みでは6つ中4つが成功すれば完了とみなし、2つ失敗しても継続できます。読み取りでは6つ中3つが成功すれば完了とみなし、3つ失敗しても大丈夫です。この仕組みにより、従来のRDSのMulti-AZよりもさらに堅牢なシステムを実現しました。

### AuroraとMySQLの関係性

ここで重要な疑問が生まれます。「これはもうMySQLではないのでは？」という点です。

確かに、Auroraは独自のDBMSエンジンといえます。内部構造は完全にオリジナルで、ストレージ層は完全に独自設計で、MySQLやPostgreSQLとは全く異なります。

しかし、**SQLの文法はMySQL/PostgreSQL互換**で、**アプリケーションからは普通のMySQL/PostgreSQLに見える**ように設計されています。これは「互換性レイヤー」という仕組みによって実現されています。

アプリケーションとAurora独自エンジンの間に互換性レイヤー（Wire Protocol）があり、この層がMySQL/PostgreSQLの振りをします。実際の処理はAurora独自エンジン（Compute Layer）で行われ、データはAurora Storage（Storage Layer）という分散ストレージ層に保存されます。

アプリケーション側から見ると、通常のMySQLと全く同じコードで接続でき、普通のSQLクエリをそのまま実行できます。使い方は従来と同じですが、内部の仕組みは全く異なるという、エレガントな設計になっています。

### AuroraとRDS MySQLの選択基準

「全部Auroraにすればいいのでは？」という疑問も当然出てきますが、実際にはケースに応じた使い分けが重要です。

**RDS MySQL（Single-AZ）**を選ぶケースは、開発・テスト環境で短時間のダウンタイムが許容でき、とにかくコストを抑えたく、冗長性が不要な場合です。

**RDS MySQL（Multi-AZ）**を選ぶケースは、特殊なMySQL機能（MyISAMエンジンやAurora非対応のプラグイン）が必要で、将来的に他クラウドへの移行可能性がある場合です。Auroraとコストはほぼ同等で、可用性も確保できます。

**Aurora**を選ぶケースは、本番環境（これが最も一般的）で、読み取り負荷が高くレプリカを複数使いたく、パフォーマンスと可用性を重視し、AWSに長期的にコミットでき、ストレージ自動拡張で運用を楽にしたく、レプリカ追加時のマスター負荷を低くしたい場合です。

実際の運用では「本番環境ならAurora」という選択で大半のケースに対応できます。

## 第10章：現代のDB技術（2020年代）

### サーバーレスDB：使った分だけ課金の時代

2020年代に入って大きなトレンドとなったのが「サーバーレス」です。これは「サーバーがない」という意味ではなく、「ユーザーがサーバーを意識しなくてよい」という概念です。

### 従来のRDSが抱えていた課題

従来のRDSでは、インスタンスタイプ（t3.micro、t3.smallなど）やストレージサイズ（20GB、100GBなど）を事前に設定する必要がありました。インスタンスは常に起動しているため、使っても使わなくても24時間課金される仕組みでした。これにより、無駄なコストの発生と、キャパシティプランニングの困難さという課題が生じていました。

### Aurora Serverlessによる解決

2018年にAurora Serverless v1、2022年にAurora Serverless v2（大幅改善版）がリリースされ、これらの問題が解決されました。

Aurora Serverlessでは、最小キャパシティ（例：0.5 ACU）と最大キャパシティ（例：16 ACU）を設定するだけで、後は自動で調整されます。ACU（Aurora Capacity Unit）は処理能力の単位で、1 ACUは約2GBメモリに相当します。

システムが自動で行うことは以下の通りです。アクセスがない時は最小ACUまで縮小し、アクセスが少ない時は0.5〜2 ACUで運用し、アクセスが増加すると自動で16 ACUまでスケールし、アクセスが減ると自動でスケールダウンします。

Aurora Serverlessは、ストレージは常に存在し、コンピュート層が必要に応じて増減する仕組みです。プロキシ層が接続を管理し、コンピュート層（可変ACU）が処理を担当し、Aurora Storageが永続化を担当します。

この仕組みは、アクセスが不規則な開発環境や週末だけのサービス、スパイク的なアクセスがある場合に適しています。一方で、常時安定したアクセスがある場合や予算を固定したい場合には従来のRDSの方が適しています。

### NewSQL：次世代の分散データベース

もう一つの大きなトレンドが「NewSQL」です。これは従来のRDBMSとNoSQLの限界を克服しようとする技術です。

### 従来のRDBMSの限界とNoSQLの登場

従来のRDBMS（MySQL、PostgreSQL）では、読み取りはリードレプリカで分散可能でしたが、書き込みはマスター1台に集中するという制約がありました。書き込みが多いアプリケーションではマスターがボトルネックとなり、手動シャーディングは可能でもアプリケーション側での実装が必要で、グローバル分散トランザクションが困難でした。

この限界を解決するため、2000年代後半に**NoSQL**（MongoDB、Cassandra、DynamoDB）が登場しました。NoSQLは簡単に水平スケーリングでき、柔軟なデータ構造を持つというメリットがありましたが、トランザクションが弱く、SQLが使えず、JOINができないというデメリットもありました。

### NewSQLのアプローチ

NewSQLは「RDBMSの厳格性 + NoSQLのスケーラビリティ」という、両方のいいとこ取りを目指す技術です。水平スケーリングが可能で、トランザクションは厳格（ACID準拠）で、SQLが使え、分散しても整合性を保証するという特徴を持ちます。

### Google Cloud Spanner：グローバル分散の実現

2017年に一般公開されたCloud Spannerは、Googleが開発した世界初のグローバル分散NewSQLです。

Spannerでは、東京リージョン、ロンドンリージョン、シドニーリージョンなど、世界中のリージョンにSpannerノード群を配置し、全てのリージョンで同じデータを参照できます。にもかかわらず、トランザクションの整合性は完全に保証されています。

これを実現しているのが、TrueTime APIという独自技術です。原子時計とGPSを使って世界中のサーバーの時刻を正確に同期することで、グローバル分散でもトランザクションの順序を保証できるのです。

アプリケーションからは普通のSQLが使え、グローバル分散環境でもトランザクションが正常に動作します。

他のNewSQL製品としては、オープンソースでPostgreSQL互換のCockroachDB、オープンソースでMySQL互換のTiDBなどがあります。

### 時系列データベース：特定用途への特化

特定の用途に特化したデータベースも増えており、その代表例が「時系列データベース」です。

### 時系列データとその特徴

時系列データとは、時刻と値のペアを大量に扱うデータです。IoTセンサーの「2024-01-01 00:00:00, 温度=20.5℃」、株価の「2024-01-01 09:00:00, 価格=1500円」、サーバー監視の「2024-01-01 00:00:00, CPU=45%」などが典型例です。

時系列データの特徴は、時刻が必ず含まれる、追記のみ（更新・削除が少ない）、時間範囲での検索が多い、データ量が膨大になる、という点です。

### 時系列DBの必要性と最適化

通常のMySQL/PostgreSQLでは、1秒間に数千〜数万レコードの書き込みに追いつかず、圧縮が弱く、時間範囲の検索が遅いという問題がありました。

時系列DBでは、LSM-tree構造による高速な追記、時系列データ用の圧縮（1/10以下）、時間範囲検索への特化という最適化が施されています。

代表的な時系列DBとしては、最も人気のあるInfluxDB（IoT、監視用途）、PostgreSQL拡張でSQLが使えるTimescaleDB（汎用）、監視に特化したPrometheus（Kubernetes監視）などがあります。

TimescaleDBでは、PostgreSQLの拡張として時系列機能を追加し、通常のSQLに加えて時系列専用の関数を使用できます。性能面でも、100万レコード挿入で通常のPostgreSQLが数分かかるところを数十秒で処理し、時間範囲検索も数秒から数百ミリ秒に高速化し、ストレージも約100MBから約10〜20MBに圧縮されます。

時系列DBは、IoTセンサーデータ、監視データ（CPU、メモリ）、金融データ（株価、為替）には適していますが、トランザクション処理（更新・削除が多い）や複雑なJOINには適していません。

## まとめ

Part04では、クラウドネイティブデータベースの誕生と、現代の多様化したデータベース技術について詳しく見てきました。

Amazon Auroraは、従来のDBMSの制約を根本的に解決するため、クラウド専用に完全に設計し直された革命的なシステムでした。ストレージとコンピュートの分離、ログベースのストレージ、クォーラムベースの耐障害性という3つの革新により、従来のRDBMSでは不可能だった性能とスケーラビリティを実現しました。

2020年代に入ってからは、Aurora Serverlessによる従量課金モデル、NewSQLによる分散トランザクション、時系列データベースによる特定用途への特化など、データベース技術はさらなる多様化と専門化を遂げています。

この記事で重要なポイントを整理します。

1. **既存技術の制約を見直す価値**
   - 既存技術の根本的な制約を見直すことで、まったく新しい価値を創造可能
   - Auroraがその典型例

2. **環境に応じた設計思想の重要性**  
   - クラウドという新しい環境には、新しい設計思想が必要
   - 従来の物理サーバー向け設計では真の潜在能力を活かせない

3. **現代のデータベース多様性**
   - 用途や要件に応じて最適化された多様な選択肢が存在
   - 一つの技術ですべてを解決する時代ではない

データベース技術の進化は止まることなく続いています。AI/ML時代のベクトルデータベース、エッジコンピューティング時代の分散データベース、量子コンピューティング時代のデータベースなど、新しい技術パラダイムが次々と生まれています。

データの性質や要件に応じて最適なデータベースを選択することが、現代のエンジニアにとって重要なスキルとなっています。この長い歴史を理解することで、なぜ現在のような多様なデータベース環境が存在するのか、そしてそれぞれがどのような問題を解決しているのかが見えてくるでしょう。

DBの根元から現代まで、この技術の歩みは人類の情報管理への絶え間ない挑戦の歴史だったのです。

---

## シリーズナビゲーション

**📖 シリーズ全体**
- [Part01：パンチカードからSQLへの道のり](https://zenn.dev/articles/71a5cc7e5d4f20)
- [Part02：商用DBMSとオープンソース革命](https://zenn.dev/articles/0ecdd417518745)
- [Part03：クラウド時代の幕開けとマネージドDB革命](https://zenn.dev/articles/d068f6c3cf7f06)
- **Part04：クラウドネイティブ時代の到来**（この記事）

**前の記事**  
[Part03：クラウド時代の幕開けとマネージドDB革命](https://zenn.dev/articles/d068f6c3cf7f06)

**シリーズ完了**  
このシリーズを通じて、1940年代のパンチカードから2020年代のクラウドネイティブデータベースまで、データベース技術の80年にわたる進化の歴史をご紹介しました。各記事では時代背景と技術革新の関係を詳しく解説していますので、興味のある時代から読み返していただけると幸いです。
